name: PR Checks
on: pull_request
jobs:
  deploy-backend-2:
    name: Deploy
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: zxyle/publish-gae-action@master
        name: Initialize Google Cloud SDK
        with:
          service_account_email: ${{ secrets.GCP_SA_EMAIL }}
          service_account_key: ${{ secrets.GCP_SERVICE_ACCOUNT }}
          project_id: ${{ secrets.GCP_PROJECT_ID }}
          gae_config_path: './packages/backend/app.yaml'
          # An optional variables parameter can be used
          # gae_variables: ${{ secrets.GAE_VARIABLES }}

      - name: Publish app to Google App Engine
        run: |
          # This client-secret.json is converted by GCP_SERVICE_ACCOUNT.
          ls
          gcloud auth activate-service-account ${{ secrets.GCP_SA_EMAIL }} --key-file=client-secret.json
          gcloud config set project ${{ secrets.GCP_PROJECT_ID }}
          gcloud -q app deploy packages/backend/app.yaml --promote

  # deploy-backend:
  #   name: Deploy to Google App Engine
  #   runs-on: ubuntu-latest
  #   steps:
  #     - uses: actions/checkout@v2
  #     - uses: vijayp23/deploy-gae-action@1.0.1
  #       with:
  #         service-account: ${{ secrets.GCP_SERVICE_ACCOUNT }}
  #         project-id: ${{ secrets.GCP_PROJECT_ID }}
  #         config-files: './packages/backend/app.yaml'

  # lint:
  #   name: Lint
  #   runs-on: ubuntu-latest
  #   steps:
  #     - uses: actions/checkout@v2
  #     - uses: actions/setup-node@v2
  #       with:
  #         node-version: '12'
  #     - run: yarn install
  #     - run: yarn workspaces run lint

  # build:
  #   name: Build
  #   runs-on: ubuntu-latest
  #   steps:
  #     - uses: actions/checkout@v2
  #     - uses: actions/setup-node@v2
  #       with:
  #         node-version: '12'
  #     - run: yarn install
  #     - run: yarn workspaces run build

  # test:
  #   name: Test
  #   runs-on: ubuntu-latest
  #   steps:
  #     - uses: actions/checkout@v2
  #     - uses: actions/setup-node@v2
  #       with:
  #         node-version: '12'
  #     - run: yarn install
  #     - run: yarn workspaces run test
